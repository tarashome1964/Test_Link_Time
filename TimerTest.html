<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Тест</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .timer { font-size: 1.2em; margin-top: 10px; }
    .question { margin-top: 20px; }
    .options label { display: block; margin: 5px 0; }
    button { margin-top: 20px; padding: 10px 20px; font-size: 1em; }
  </style>
</head>
<body>
  <h1 id="title">Завантаження...</h1>
  <div class="timer">
    ⏳ Тривалість: <span id="duration">--</span> хв<br>
    Залишилось: <span id="remaining">--:--</span>
  </div>
  <button id="startBtn" style="display:none;">Почати тест</button>
  <div id="testArea"></div>
  <button id="showAnswersBtn" style="display:none;">Переглянути відповіді</button>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const testId = urlParams.get('id');

    if (!testId || testId.trim() === "") {
      document.getElementById('title').textContent = "Не вказано тест";
      document.getElementById('duration').textContent = "0";
      document.getElementById('remaining').textContent = "Час вичерпано";
    } else {
      const jsonUrl = `${testId}.json`;

      fetch(jsonUrl)
        .then(response => {
          if (!response.ok) throw new Error("Файл не знайдено");
          return response.json();
        })
        .then(data => {
          document.getElementById('title').textContent = data.title || "Без назви";
          document.getElementById('duration').textContent = data.duration || "0";
          document.getElementById('startBtn').style.display = "inline-block";

          let seconds = (data.duration || 0) * 60;
          const remainingEl = document.getElementById('remaining');
          const testArea = document.getElementById('testArea');

          function updateTimer() {
            if (seconds <= 0) {
              remainingEl.textContent = "Час вичерпано";
              document.getElementById('showAnswersBtn').style.display = "inline-block";
              return;
            }
            const min = Math.floor(seconds / 60);
            const sec = seconds % 60;
            remainingEl.textContent = `${min}:${sec.toString().padStart(2, '0')}`;
            seconds--;
            setTimeout(updateTimer, 1000);
          }

          function renderTest() {
            testArea.innerHTML = "";
            data.questions.forEach((item, index) => {
              const div = document.createElement('div');
              div.className = "question";
              div.innerHTML = `<strong>${index + 1}. ${item.q}</strong>`;
              const optionsDiv = document.createElement('div');
              optionsDiv.className = "options";
              item.options.forEach(opt => {
                const id = `q${index}_${opt}`;
                optionsDiv.innerHTML += `
                  <label><input type="radio" name="q${index}" value="${opt}" id="${id}"> ${opt}</label>
                `;
              });
              div.appendChild(optionsDiv);
              testArea.appendChild(div);
            });
          }

          document.getElementById('startBtn').onclick = () => {
            document.getElementById('startBtn').disabled = true;
            renderTest();
            updateTimer();
          };

          document.getElementById('showAnswersBtn').onclick = () => {
            let result = "Правильні відповіді:\n\n";
            data.questions.forEach((item, index) => {
              result += `${index + 1}. ${item.q}\n→ ${item.a}\n\n`;
            });
            alert(result);
          };
        })
        .catch(err => {
          document.getElementById('title').textContent = "Помилка завантаження";
          document.getElementById('duration').textContent = "0";
          document.getElementById('remaining').textContent = "Час вичерпано";
        });
    }
  </script>
</body>
</html>
